{% comment %}
  Day Shrooms Landing Page Product Buy Box Section
{% endcomment %}

{%- liquid
  assign selected_product = section.settings.product
  if selected_product == blank
    assign selected_product = all_products[section.settings.product_handle]
  endif
  assign variant_images = selected_product.images | where: 'attached_to_variant?', true | map: 'src'
-%}

{{ 'section-main-product.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-rating.css' | asset_url | stylesheet_tag }}
{{ 'component-deferred-media.css' | asset_url | stylesheet_tag }}

{% unless selected_product.has_only_default_variant %}
  {{ 'component-product-variant-picker.css' | asset_url | stylesheet_tag }}
  {{ 'component-swatch-input.css' | asset_url | stylesheet_tag }}
  {{ 'component-swatch.css' | asset_url | stylesheet_tag }}
{% endunless %}

{% if selected_product.media.size > 0 %}
  <script src="{{ 'product-modal.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'media-gallery.js' | asset_url }}" defer="defer"></script>
{% endif %}

<style>
  .ds-lp-prod-buy-box {
    background-color: #000000;
    color: #FFFFFF;
  }
  
  /* Ensure main gallery shows one image at a time */
  #ds-lp--prod-buy-box .product__media-list {
    display: flex !important;
    overflow: hidden;
  }
  
  #ds-lp--prod-buy-box .product__media-item {
    flex: 0 0 100%;
    width: 100%;
    display: none;
    border-radius: 20px;
    overflow: hidden;
  }
  
  #ds-lp--prod-buy-box .product__media-item.is-active {
    display: block;
  }
  
  #ds-lp--prod-buy-box .product__media img,
  #ds-lp--prod-buy-box .product__media-wrapper img {
    border-radius: 20px;
  }
  
  /* Disable zoom feature */
  #ds-lp--prod-buy-box .product__media-icon {
    display: none !important;
  }
  
  #ds-lp--prod-buy-box .product__modal-opener {
    pointer-events: none;
    cursor: default !important;
  }
  
  #ds-lp--prod-buy-box .product__media-wrapper {
    cursor: default !important;
  }
  
  #ds-lp--prod-buy-box .product__media-wrapper:hover {
    transform: none !important;
  }
  
  /* Gallery Navigation Arrows */
  #ds-lp--prod-buy-box .ds-lp-gallery-wrapper {
    position: relative;
  }
  
  #ds-lp--prod-buy-box .ds-lp-gallery-arrow {
    position: absolute;
    top: 40%;
    transform: translateY(-50%);
    z-index: 10;
    width: 48px;
    height: 48px;
    display: none; /* Hidden on mobile */
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    opacity: 0.8;
    background: transparent;
    border: none;
    padding: 0;
  }
  
  #ds-lp--prod-buy-box .ds-lp-gallery-arrow:hover {
    opacity: 1;
    transform: translateY(-50%) scale(1.05);
  }
  
  #ds-lp--prod-buy-box .ds-lp-gallery-arrow:active {
    transform: translateY(-50%) scale(0.95);
  }
  
  #ds-lp--prod-buy-box .ds-lp-gallery-arrow--prev {
    left: 16px;
  }
  
  #ds-lp--prod-buy-box .ds-lp-gallery-arrow--next {
    right: 16px;
  }
  
  #ds-lp--prod-buy-box .ds-lp-gallery-arrow svg {
    width: 48px;
    height: 48px;
    display: block;
  }
  
  #ds-lp--prod-buy-box .ds-lp-gallery-arrow[disabled] {
    opacity: 0.3;
    cursor: not-allowed;
    pointer-events: none;
  }
  
  @media (min-width: 750px) {
    #ds-lp--prod-buy-box .ds-lp-gallery-arrow {
      display: flex; /* Show on tablet and desktop */
      width: 56px;
      height: 56px;
    }
    
    #ds-lp--prod-buy-box .ds-lp-gallery-arrow--prev {
      left: 24px;
    }
    
    #ds-lp--prod-buy-box .ds-lp-gallery-arrow--next {
      right: 24px;
    }
    
    #ds-lp--prod-buy-box .ds-lp-gallery-arrow svg {
      width: 56px;
      height: 56px;
    }
  }
  
  /* Thumbnail sizes and spacing */
  #ds-lp--prod-buy-box .thumbnail-slider {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
  
  #ds-lp--prod-buy-box .thumbnail-list {
    gap: 8px !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
  
  @media (min-width: 750px) {
    #ds-lp--prod-buy-box .product__media-item {
      display: none;
    }
    
    #ds-lp--prod-buy-box .product__media-item.is-active {
      display: block;
    }
    
    /* Thumbnail sizes and spacing - Desktop */
    #ds-lp--prod-buy-box .thumbnail-list {
      gap: 16px !important;
    }
  }
  
  .ds-lp-prod-buy-box__rating {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .ds-lp-prod-buy-box__stars {
    display: flex;
    gap: 4px;
  }
  
  .ds-lp-prod-buy-box__star {
    width: 20px;
    height: 20px;
    color: #FFD700;
  }
  
  .ds-lp-prod-buy-box__price-highlight {
    color: #E4FF52;
  }
  
  .ds-lp-prod-buy-box__buy-options {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin-bottom: 24px;
  }
  
  .ds-lp-prod-buy-box__buy-option {
    background: #1A1A1A;
    border: 1px solid #FFFFFF40;
    border-radius: 16px;
    padding: 12px 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    opacity: 0.5;
  }
  
  .ds-lp-prod-buy-box__buy-option.selected {
    background: #1A1A1A;
    opacity: 1;
  }
  
  .ds-lp-prod-buy-box__buy-option-header {
    display: flex;
    align-items: center;
    gap: 12px;
    /* margin-bottom: 16px; */
  }
  
  .ds-lp-prod-buy-box__buy-option[data-option="bundle"] .ds-lp-prod-buy-box__buy-option-header {
    padding-bottom: 16px;
    border-bottom: 1px solid rgba(217, 217, 217, 0.25);
    margin-bottom: 16px;
  }
  
  .ds-lp-prod-buy-box__radio {
    width: 24px;
    height: 24px;
    border: 2px solid #FFFFFF80;
    border-radius: 50%;
    position: relative;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #0F0F0F;
    transition: all 0.3s ease;
  }
  
  .ds-lp-prod-buy-box__buy-option.selected .ds-lp-prod-buy-box__radio {
    border-color: #EC008C;
    background: #EC008C;
  }
  
  .ds-lp-prod-buy-box__radio-check {
    width: 12px;
    height: 10px;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .ds-lp-prod-buy-box__buy-option.selected .ds-lp-prod-buy-box__radio-check {
    opacity: 1;
  }
  
  .ds-lp-prod-buy-box__buy-option-title-wrapper {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex: 1;
    gap: 12px;
    width: 100%;
  }
  
  .ds-lp-prod-buy-box__buy-option-title {
    font-size: 18px;
    font-weight: 700;
    line-height: 1.4;
    letter-spacing: -0.9px;
    color: #FFFFFF;
  }
  
  .ds-lp-prod-buy-box__price-wrapper {
    display: flex;
    align-items: center;
    gap: 12px;
    justify-content: flex-end;
    min-width: fit-content;
  }
  
  .ds-lp-prod-buy-box__price {
    font-size: 24px;
    font-weight: 700;
    line-height: 1.2;
    letter-spacing: -1.2px;
    color: #FFFFFF;
  }
  
  .ds-lp-prod-buy-box__buy-option[data-option="bundle"] .ds-lp-prod-buy-box__price {
    color: #E4FF52;
  }
  
  .ds-lp-prod-buy-box__price-strikethrough {
    font-size: 20px;
    font-weight: 600;
    line-height: 1.2;
    letter-spacing: -1px;
    color: rgba(255, 255, 255, 0.4);
    text-decoration: line-through;
  }
  
  .ds-lp-prod-buy-box__benefits {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }
  
  .ds-lp-prod-buy-box__benefit-item {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .ds-lp-prod-buy-box__checkmark {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
    color: #E74639;
  }
  
  .ds-lp-prod-buy-box__benefit-text {
    font-size: 14px;
    line-height: 1.5;
    letter-spacing: -0.7px;
    color: #FFFFFF;
  }
  
  .ds-lp-prod-buy-box__separator {
    display: flex;
    align-items: center;
    gap: 16px;
    margin: 16px 0;
    width: 100%;
  }
  
  .ds-lp-prod-buy-box__separator-line {
    flex: 1;
    height: 1px;
    background: #FFFFFF40;
  }
  
  .ds-lp-prod-buy-box__separator-text {
    font-size: 14px;
    line-height: 1.5;
    letter-spacing: -0.7px;
    color: #FFFFFF;
  }
  
  .ds-lp-prod-buy-box__cta-button {
    background: #E4FF52;
    color: #000000;
    font-weight: 700;
    padding: 12px 24px;
    border-radius: 100px;
    text-align: center;
    display: block;
    width: 100%;
    transition: all 0.3s ease;
    text-decoration: none;
  }
  
  .ds-lp-prod-buy-box__tabs {
    display: flex;
    gap: 24px;
    margin-top: 24px;
    overflow-x: auto;
    white-space: nowrap;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
  }
  
  .ds-lp-prod-buy-box__tabs::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }
  
  .ds-lp-prod-buy-box__tab {
    padding: 8px 0;
    cursor: pointer;
    color: #FFFFFF;
    opacity: 0.5;
    border-bottom: 2px solid transparent;
    transition: all 0.3s ease;
    font-size: 18px;
    line-height: 1.5;
    letter-spacing: -0.9px;
    font-weight: 400;
    white-space: nowrap;
    flex-shrink: 0;
  }
  
  .ds-lp-prod-buy-box__tab.active {
    color: #FFFFFF;
    border-bottom-color: #FFFFFF;
    opacity: 1;
    font-weight: 700;
  }
  
  .ds-lp-prod-buy-box__tab-content {
    display: none;
    padding-top: 24px;
  }
  
  .ds-lp-prod-buy-box__tab-content.active {
    display: block;
  }
  
  @media (min-width: 1024px) {
    .ds-lp-prod-buy-box__buy-option {
      padding: 24px;
    }
    
    .ds-lp-prod-buy-box__buy-option-title {
      font-size: 24px;
      letter-spacing: -1.2px;
    }
    
    .ds-lp-prod-buy-box__benefit-text {
      font-size: 16px;
      letter-spacing: -0.8px;
    }
  }
  
  /* Clear Cart Button */
  .ds-lp-prod-buy-box__clear-cart {
    background: transparent;
    border: none;
    padding: 0;
    color: #FFFFFF;
    text-decoration: underline;
    cursor: pointer;
    transition: opacity 0.3s ease;
  }
  
  .ds-lp-prod-buy-box__clear-cart:hover {
    opacity: 0.7;
  }
  
  /* Notification */
  .ds-lp-prod-buy-box__notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #E4FF52;
    color: #000000;
    padding: 16px 24px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 600;
    font-size: 14px;
    letter-spacing: -0.7px;
    z-index: 1000;
    opacity: 0;
    transform: translateY(-20px);
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  
  .ds-lp-prod-buy-box__notification.show {
    opacity: 1;
    transform: translateY(0);
  }
  
  .ds-lp-prod-buy-box__notification-icon {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
  }
</style>

<section class="ds-lp-prod-buy-box" id="ds-lp--prod-buy-box">
  <div class="mx-auto px-5 sm:px-6 lg:px-16 py-16 lg:py-24">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-20">
      {% comment %} Left Column - Product Images {% endcomment %}
      <div class="order-1 lg:order-1">
        {% if selected_product != blank and selected_product.media.size > 0 %}
          <div class="ds-lp-gallery-wrapper">
            {% render 'product-media-gallery', 
              product: selected_product, 
              variant_images: variant_images,
              section: section
            %}
            {% comment %} Navigation Arrows {% endcomment %}
            {% if selected_product.media.size > 1 %}
              <button 
                type="button"
                class="ds-lp-gallery-arrow ds-lp-gallery-arrow--prev"
                aria-label="Previous image"
                data-gallery-prev
              >
                <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="0.5" y="0.5" width="47" height="47" rx="23.5" stroke="black"></rect>
                  <path d="M32 23H19.83L25.42 17.41L24 16L16 24L24 32L25.41 30.59L19.83 25H32V23Z" fill="black"></path>
                </svg>
              </button>
              <button 
                type="button"
                class="ds-lp-gallery-arrow ds-lp-gallery-arrow--next"
                aria-label="Next image"
                data-gallery-next
              >
                <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="0.5" y="0.5" width="47" height="47" rx="23.5" stroke="black"></rect>
                  <path d="M24 16L22.59 17.41L28.17 23H16V25H28.17L22.59 30.59L24 32L32 24L24 16Z" fill="black"></path>
                </svg>
              </button>
            {% endif %}
          </div>
        {% else %}
          <div class="bg-gray-200 rounded-lg p-20 flex items-center justify-center">
            <p class="text-gray-400">No product selected or product has no images</p>
          </div>
        {% endif %}
      </div>
      
      {% comment %} Right Column - Product Info {% endcomment %}
      <div class="order-2 lg:order-2">
        {% comment %} Rating {% endcomment %}
        {% if section.settings.rating_text != blank %}
          <div class="ds-lp-prod-buy-box__rating">
            <div class="ds-lp-prod-buy-box__stars">
              {% comment %} 4 Full Stars {% endcomment %}
              {% for i in (1..4) %}
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7.25672 0.489876C7.53172 -0.163293 8.46832 -0.163292 8.74332 0.489878L10.3663 4.345C10.4823 4.62036 10.7445 4.8085 11.0454 4.83233L15.2582 5.166C15.9719 5.22253 16.2614 6.10252 15.7175 6.56274L12.5079 9.27896C12.2786 9.473 12.1784 9.77745 12.2485 10.0675L13.2291 14.1288C13.3952 14.8169 12.6375 15.3608 12.0264 14.9921L8.41965 12.8157C8.16202 12.6602 7.83802 12.6602 7.5804 12.8157L3.9736 14.9921C3.3625 15.3608 2.60477 14.8169 2.77091 14.1288L3.75155 10.0675C3.82159 9.77745 3.72147 9.473 3.49221 9.27896L0.28245 6.56274C-0.261375 6.10252 0.0280544 5.22253 0.741835 5.166L4.9547 4.83233C5.25561 4.8085 5.51774 4.62036 5.63367 4.345L7.25672 0.489876Z" fill="#EC008C"/>
                </svg>
              {% endfor %}
              {% comment %} 1 Half Star {% endcomment %}
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M15.9144 5.65609L15.9782 5.85609C16.0307 6.00704 15.9865 6.17481 15.8665 6.28009L11.9892 9.6001L13.138 14.5761C13.1769 14.7351 13.1172 14.9021 12.9864 15.0001L12.8109 15.1201C12.7427 15.1737 12.6582 15.2019 12.5716 15.2001C12.4985 15.2016 12.4266 15.1822 12.3642 15.1441L8.00016 12.4801L3.66011 15.1441C3.59771 15.1822 3.52573 15.2016 3.45267 15.2001C3.36607 15.2019 3.28151 15.1737 3.21334 15.1201L3.01388 15.0001C2.88308 14.9021 2.8234 14.7351 2.8623 14.5761L4.01114 9.6001L0.14179 6.28809C0.0156062 6.18343 -0.0321581 6.01101 0.0221197 5.85609L0.109878 5.65609C0.15654 5.49803 0.296829 5.38613 0.460912 5.37609L5.55888 4.96809L7.5135 0.256089C7.57613 0.0996049 7.72831 -0.00212468 7.89645 8.89161e-05H8.10385C8.27049 -0.00345668 8.42105 0.0993273 8.47881 0.256089L10.4654 4.96809L15.5634 5.37609C15.7275 5.38613 15.8677 5.49803 15.9144 5.65609ZM11.2871 12.8481L10.3936 9.1041L13.3215 6.60009L9.48409 6.29609L8.00016 2.72809V10.8401L11.2871 12.8481Z" fill="#EC008C"/>
              </svg>
            </div>
            <span class="text-sm leading-[1.5] tracking-[-0.7px] text-white">{{ section.settings.rating_text }}</span>
          </div>
        {% endif %}
        
        {% comment %} Headline {% endcomment %}
        {% if section.settings.headline != blank %}
          <h2 class="text-[32px] lg:text-[48px] leading-[1.2] tracking-[-1.6px] lg:tracking-[-2.4px] font-bold mt-6 mb-2 text-white">
            {{ section.settings.headline }}
          </h2>
        {% endif %}
        
        {% comment %} Tagline {% endcomment %}
        {% if section.settings.tagline != blank %}
          <p class="text-lg lg:text-xl leading-[1.4] tracking-[-0.9px] lg:tracking-[-1px] mb-6 text-white">
            {{ section.settings.tagline }}
          </p>
        {% endif %}
        
        {% comment %} Buy Options {% endcomment %}
        <div class="ds-lp-prod-buy-box__buy-options">
          {% comment %} Option 1: Buy 2 Get 1 Free {% endcomment %}
          <div class="ds-lp-prod-buy-box__buy-option selected" data-option="bundle">
            <div class="ds-lp-prod-buy-box__buy-option-header">
              <div class="ds-lp-prod-buy-box__radio">
                <svg class="ds-lp-prod-buy-box__radio-check" width="12" height="10" viewBox="0 0 12 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M3.91869 6.90412L1.17719 4.16262L0 5.33981L3.91869 9.2585L12 1.17719L10.8228 0L3.91869 6.90412Z" fill="white"/>
                </svg>
              </div>
              <div class="ds-lp-prod-buy-box__buy-option-title-wrapper">
                <div class="ds-lp-prod-buy-box__buy-option-title">
                  {{ section.settings.bundle_option_title | default: "Buy 2, Get 1 Free" }}
                </div>
                <div class="ds-lp-prod-buy-box__price-wrapper">
                  <span class="ds-lp-prod-buy-box__price">{{ section.settings.bundle_price | default: "$78" }}</span>
                  {% if section.settings.bundle_price_original != blank %}
                    <span class="ds-lp-prod-buy-box__price-strikethrough">{{ section.settings.bundle_price_original }}</span>
                  {% endif %}
                </div>
              </div>
            </div>
            {% if section.blocks.size > 0 %}
              <div class="ds-lp-prod-buy-box__benefits">
                {% for block in section.blocks %}
                  {% case block.type %}
                    {% when 'bundle_benefit' %}
                      <div class="ds-lp-prod-buy-box__benefit-item">
                        <svg class="ds-lp-prod-buy-box__checkmark" width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <g clip-path="url(#clip0_1_3082)">
                            <rect width="22" height="22" rx="11" fill="#E74936"/>
                            <mask id="mask0_1_3082" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="4" y="4" width="28" height="28">
                              <rect x="4" y="4" width="28" height="28" fill="#D9D9D9"/>
                            </mask>
                            <g mask="url(#mask0_1_3082)">
                              <path d="M9.25334 15.2775L5.18945 11.2136L6.20543 10.1976L9.25334 13.2455L15.7948 6.7041L16.8108 7.72007L9.25334 15.2775Z" fill="white"/>
                            </g>
                          </g>
                          <defs>
                            <clipPath id="clip0_1_3082">
                              <rect width="22" height="22" rx="11" fill="white"/>
                            </clipPath>
                          </defs>
                        </svg>
                        <span class="ds-lp-prod-buy-box__benefit-text">{{ block.settings.text }}</span>
                      </div>
                  {% endcase %}
                {% endfor %}
              </div>
            {% endif %}
          </div>
          
          {% comment %} Separator {% endcomment %}
          <div class="ds-lp-prod-buy-box__separator">
            <div class="ds-lp-prod-buy-box__separator-line">

            </div>
            <div class="ds-lp-prod-buy-box__separator-text">OR</div>
            <div class="ds-lp-prod-buy-box__separator-line">

            </div>
          </div>
          
          {% comment %} Option 2: Buy One Time {% endcomment %}
          <div class="ds-lp-prod-buy-box__buy-option" data-option="single">
            <div class="ds-lp-prod-buy-box__buy-option-header">
              <div class="ds-lp-prod-buy-box__radio">
                <svg class="ds-lp-prod-buy-box__radio-check" width="12" height="10" viewBox="0 0 12 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M3.91869 6.90412L1.17719 4.16262L0 5.33981L3.91869 9.2585L12 1.17719L10.8228 0L3.91869 6.90412Z" fill="white"/>
                </svg>
              </div>
              <div class="ds-lp-prod-buy-box__buy-option-title-wrapper">
                <div class="ds-lp-prod-buy-box__buy-option-title">
                  {{ section.settings.single_option_title | default: "Buy One Time" }}
                </div>
                <div class="ds-lp-prod-buy-box__price-wrapper">
                  <span class="ds-lp-prod-buy-box__price">{{ section.settings.single_price | default: "$39" }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        {% comment %} Add to Cart Form {% endcomment %}
        {% if selected_product != blank %}
          {%- form 'product', selected_product, id: 'ds-lp-prod-buy-box-form', class: 'ds-lp-prod-buy-box__form' -%}
            <input type="hidden" name="id" value="{{ selected_product.selected_or_first_available_variant.id }}" id="ds-lp-prod-buy-box-variant-id">
            <input type="hidden" name="quantity" value="1" id="ds-lp-prod-buy-box-quantity">
            <button
              type="submit"
              name="add"
              class="ds-lp-prod-buy-box__cta-button text-base lg:text-lg leading-[1.5] tracking-[-0.7px] lg:tracking-[-0.8px] mb-4"
              {% if selected_product.selected_or_first_available_variant.available == false %}
                disabled
              {% endif %}
            >
              {{ section.settings.cta_text | default: 'Add to Cart' }}
            </button>
          {%- endform -%}
        {% endif %}

        <div class="flex justify-between items-center mb-6">

          <button 
            type="button"
            class="ds-lp-prod-buy-box__clear-cart font-medium underline uppercase text-sm tracking-[-0.7px]"
            id="ds-lp-clear-cart-btn"
          >
            CLEAR CART
          </button>
          {% comment %} Free Shipping Text {% endcomment %}
          {% if section.settings.free_shipping_text != blank %}
            <p class="text-xs leading-[1.5] tracking-[-0.6px] text-right">
              {{ section.settings.free_shipping_text }}
            </p>
          {% endif %}
        </div>
        
        
        
        {% comment %} Tabs {% endcomment %}
        <div class="ds-lp-prod-buy-box__tabs">
          {% if section.settings.tab_details_label != blank %}
            <div 
              class="ds-lp-prod-buy-box__tab active"
              data-tab-target="details"
              data-section-id="{{ section.id }}"
            >
              {{ section.settings.tab_details_label }}
            </div>
          {% endif %}
          {% if section.settings.tab_ingredients_label != blank %}
            <div 
              class="ds-lp-prod-buy-box__tab"
              data-tab-target="ingredients"
              data-section-id="{{ section.id }}"
            >
              {{ section.settings.tab_ingredients_label }}
            </div>
          {% endif %}
          {% if section.settings.tab_easy_to_make_label != blank %}
            <div 
              class="ds-lp-prod-buy-box__tab"
              data-tab-target="easy-to-make"
              data-section-id="{{ section.id }}"
            >
              {{ section.settings.tab_easy_to_make_label }}
            </div>
          {% endif %}
          {% if section.settings.tab_guarantee_label != blank %}
            <div 
              class="ds-lp-prod-buy-box__tab"
              data-tab-target="guarantee"
              data-section-id="{{ section.id }}"
            >
              {{ section.settings.tab_guarantee_label }}
            </div>
          {% endif %}
        </div>
        
        {% comment %} Tab Content {% endcomment %}
        <div class="ds-lp-prod-buy-box__tab-content active" id="tab-details-{{ section.id }}">
          {% if section.settings.tab_details_content != blank %}
            <div class="text-white text-base lg:text-lg leading-[1.5] tracking-[-0.7px] lg:tracking-[-0.9px]">
              {{ section.settings.tab_details_content }}
            </div>
          {% endif %}
        </div>
        
        <div class="ds-lp-prod-buy-box__tab-content" id="tab-ingredients-{{ section.id }}">
          {% if section.settings.tab_ingredients_content != blank %}
            <div class="text-white text-base lg:text-lg leading-[1.5] tracking-[-0.7px] lg:tracking-[-0.9px]">
              {{ section.settings.tab_ingredients_content }}
            </div>
          {% endif %}
        </div>
        
        <div class="ds-lp-prod-buy-box__tab-content" id="tab-easy-to-make-{{ section.id }}">
          {% if section.settings.tab_easy_to_make_content != blank %}
            <div class="text-white text-base lg:text-lg leading-[1.5] tracking-[-0.7px] lg:tracking-[-0.9px]">
              {{ section.settings.tab_easy_to_make_content }}
            </div>
          {% endif %}
        </div>
        
        <div class="ds-lp-prod-buy-box__tab-content" id="tab-guarantee-{{ section.id }}">
          {% if section.settings.tab_guarantee_content != blank %}
            <div class="text-white text-base lg:text-lg leading-[1.5] tracking-[-0.7px] lg:tracking-[-0.9px]">
              {{ section.settings.tab_guarantee_content }}
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  (function() {
    const sectionId = '{{ section.id }}';
    const section = document.getElementById('ds-lp--prod-buy-box');
    
    if (section) {
      const quantityInput = document.getElementById('ds-lp-prod-buy-box-quantity');
      const form = section.querySelector('.ds-lp-prod-buy-box__form');
      
      // Gallery Navigation Arrows
      const galleryWrapper = section.querySelector('.ds-lp-gallery-wrapper');
      if (galleryWrapper) {
        const mediaGallery = galleryWrapper.querySelector('media-gallery');
        const viewer = galleryWrapper.querySelector('[id^="GalleryViewer"]');
        const prevButton = galleryWrapper.querySelector('[data-gallery-prev]');
        const nextButton = galleryWrapper.querySelector('[data-gallery-next]');
        const mediaItems = galleryWrapper.querySelectorAll('.product__media-item[data-media-id]');
        
        function updateArrowStates() {
          if (!mediaItems.length || !prevButton || !nextButton) return;
          
          const activeIndex = Array.from(mediaItems).findIndex(item => item.classList.contains('is-active'));
          const totalItems = mediaItems.length;
          
          // Disable prev button if on first item
          if (activeIndex === 0) {
            prevButton.setAttribute('disabled', 'disabled');
          } else {
            prevButton.removeAttribute('disabled');
          }
          
          // Disable next button if on last item
          if (activeIndex === totalItems - 1) {
            nextButton.setAttribute('disabled', 'disabled');
          } else {
            nextButton.removeAttribute('disabled');
          }
        }
        
        function navigateGallery(direction) {
          if (!mediaGallery || !viewer) return;
          
          const activeItem = viewer.querySelector('.product__media-item.is-active');
          if (!activeItem) return;
          
          const currentMediaId = activeItem.getAttribute('data-media-id');
          const allMediaItems = Array.from(viewer.querySelectorAll('.product__media-item[data-media-id]'));
          const currentIndex = allMediaItems.findIndex(item => item.getAttribute('data-media-id') === currentMediaId);
          
          let targetIndex;
          if (direction === 'next') {
            targetIndex = currentIndex + 1;
            if (targetIndex >= allMediaItems.length) return;
          } else {
            targetIndex = currentIndex - 1;
            if (targetIndex < 0) return;
          }
          
          const targetMediaId = allMediaItems[targetIndex].getAttribute('data-media-id');
          
          // Try to use the media gallery's setActiveMedia method first
          if (mediaGallery && typeof mediaGallery.setActiveMedia === 'function') {
            mediaGallery.setActiveMedia(targetMediaId, false);
          } else {
            // Fallback: manually set active
            allMediaItems.forEach(item => item.classList.remove('is-active'));
            allMediaItems[targetIndex].classList.add('is-active');
          }
          
          // Update arrow states after a short delay
          setTimeout(updateArrowStates, 150);
        }
        
        if (prevButton) {
          prevButton.addEventListener('click', function(e) {
            e.preventDefault();
            navigateGallery('prev');
          });
        }
        
        if (nextButton) {
          nextButton.addEventListener('click', function(e) {
            e.preventDefault();
            navigateGallery('next');
          });
        }
        
        // Touch swipe support for mobile screen sizes
        let touchStartX = 0;
        let touchEndX = 0;
        const minSwipeDistance = 50; // Minimum distance in pixels to trigger a swipe
        
        function isMobileScreen() {
          return window.innerWidth < 750;
        }
        
        if (viewer) {
          viewer.addEventListener('touchstart', function(e) {
            if (isMobileScreen()) {
              touchStartX = e.changedTouches[0].screenX;
            }
          }, { passive: true });
          
          viewer.addEventListener('touchend', function(e) {
            if (isMobileScreen()) {
              touchEndX = e.changedTouches[0].screenX;
              handleSwipe();
            }
          }, { passive: true });
        }
        
        function handleSwipe() {
          if (!isMobileScreen()) return;
          
          const swipeDistance = touchStartX - touchEndX;
          
          // Swipe left (next)
          if (swipeDistance > minSwipeDistance) {
            navigateGallery('next');
          }
          // Swipe right (prev)
          else if (swipeDistance < -minSwipeDistance) {
            navigateGallery('prev');
          }
        }
        
        // Update arrow states on initial load
        updateArrowStates();
        
        // Update arrow states when slide changes (listen to custom event or use MutationObserver)
        if (viewer) {
          viewer.addEventListener('slideChanged', updateArrowStates);
          
          // Also use MutationObserver to watch for class changes
          const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
              if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                updateArrowStates();
              }
            });
          });
          
          mediaItems.forEach(item => {
            observer.observe(item, { attributes: true, attributeFilter: ['class'] });
          });
        }
      }
      
      // Buy option selection
      const buyOptions = section.querySelectorAll('.ds-lp-prod-buy-box__buy-option');
      
      // Function to update quantity based on selected option
      function updateQuantityForSelectedOption() {
        const selectedOption = section.querySelector('.ds-lp-prod-buy-box__buy-option.selected');
        if (selectedOption && quantityInput) {
          const optionType = selectedOption.getAttribute('data-option');
          if (optionType === 'bundle') {
            quantityInput.value = 3; // Buy 2, Get 1 Free = 3 items
          } else if (optionType === 'single') {
            quantityInput.value = 1; // Buy One Time = 1 item
          }
        }
      }
      
      // Initialize quantity on page load based on default selected option
      updateQuantityForSelectedOption();
      
      buyOptions.forEach(option => {
        option.addEventListener('click', function() {
          // Remove selected from all options
          buyOptions.forEach(opt => {
            opt.classList.remove('selected');
          });
          
          // Add selected to clicked option
          this.classList.add('selected');
          
          // Update quantity based on selected option
          updateQuantityForSelectedOption();
        });
      });
      
      // Form submission - redirect to checkout
      if (form) {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          
          const formData = new FormData(form);
          
          // Add to cart via AJAX
          fetch('/cart/add.js', {
            method: 'POST',
            body: formData
          })
          .then(response => response.json())
          .then(data => {
            // Redirect to checkout
            window.location.href = '/checkout';
          })
          .catch(error => {
            console.error('Error adding to cart:', error);
            // Fallback: redirect to cart page
            window.location.href = '/cart';
          });
        });
      }
      
      // Tab switching
      const tabs = section.querySelectorAll('.ds-lp-prod-buy-box__tab[data-tab-target]');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', function() {
          const tabName = this.getAttribute('data-tab-target');
          
          // Hide all tab contents
          const allContents = section.querySelectorAll('.ds-lp-prod-buy-box__tab-content');
          allContents.forEach(content => {
            content.classList.remove('active');
          });
          
          // Remove active from all tabs
          tabs.forEach(t => {
            t.classList.remove('active');
          });
          
          // Show selected tab content
          const selectedContent = section.querySelector('#tab-' + tabName + '-' + sectionId);
          if (selectedContent) {
            selectedContent.classList.add('active');
          }
          
          // Add active to clicked tab
          this.classList.add('active');
        });
      });
      
      // Clear Cart Functionality
      const clearCartBtn = document.getElementById('ds-lp-clear-cart-btn');
      if (clearCartBtn) {
        clearCartBtn.addEventListener('click', function() {
          // Show notification
          function showNotification() {
            // Remove existing notification if any
            const existingNotification = document.querySelector('.ds-lp-prod-buy-box__notification');
            if (existingNotification) {
              existingNotification.remove();
            }
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'ds-lp-prod-buy-box__notification';
            notification.innerHTML = `
              <svg class="ds-lp-prod-buy-box__notification-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M16.6667 5L7.50004 14.1667L3.33337 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>Cart cleared successfully</span>
            `;
            
            document.body.appendChild(notification);
            
            // Trigger animation
            setTimeout(() => {
              notification.classList.add('show');
            }, 10);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
              notification.classList.remove('show');
              setTimeout(() => {
                notification.remove();
              }, 300);
            }, 3000);
          }
          
          // Clear cart using Shopify Cart API
          fetch('/cart/clear.js', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            }
          })
          .then(response => response.json())
          .then(data => {
            showNotification();
            
            // Dispatch cart update event for other parts of the site
            document.dispatchEvent(new CustomEvent('cart:updated'));
            
            // Update cart count if there's a cart drawer or counter
            if (window.theme && window.theme.cart) {
              window.theme.cart.getCart();
            }
          })
          .catch(error => {
            console.error('Error clearing cart:', error);
            // Still show notification even if there's an error
            showNotification();
          });
        });
      }
    }
  })();
</script>

{% if selected_product != blank and selected_product.media.size > 0 %}
  {% render 'product-media-modal', 
    product: selected_product, 
    variant_images: variant_images,
    section: section
  %}
{% endif %}

{% schema %}
{
  "name": "DS LP Product Buy Box",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Product"
    },
    {
      "type": "product",
      "id": "product",
      "label": "Product"
    },
    {
      "type": "header",
      "content": "Gallery Settings"
    },
    {
      "type": "select",
      "id": "gallery_layout",
      "options": [
        {
          "value": "stacked",
          "label": "Stacked"
        },
        {
          "value": "columns",
          "label": "Columns"
        },
        {
          "value": "thumbnail",
          "label": "Thumbnail"
        },
        {
          "value": "thumbnail_slider",
          "label": "Thumbnail Slider"
        }
      ],
      "default": "thumbnail_slider",
      "label": "Gallery Layout"
    },
    {
      "type": "select",
      "id": "mobile_thumbnails",
      "options": [
        {
          "value": "columns",
          "label": "Columns"
        },
        {
          "value": "show",
          "label": "Show"
        },
        {
          "value": "hide",
          "label": "Hide"
        }
      ],
      "default": "show",
      "label": "Mobile Thumbnails"
    },
    {
      "type": "checkbox",
      "id": "hide_variants",
      "default": false,
      "label": "Hide Variant Images"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_info",
      "default": false,
      "label": "Enable Sticky Info"
    },
    {
      "type": "select",
      "id": "media_size",
      "options": [
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ],
      "default": "large",
      "label": "Media Size"
    },
    {
      "type": "checkbox",
      "id": "enable_video_looping",
      "default": false,
      "label": "Enable Video Looping"
    },
    {
      "type": "select",
      "id": "media_fit",
      "options": [
        {
          "value": "contain",
          "label": "Contain"
        },
        {
          "value": "cover",
          "label": "Cover"
        }
      ],
      "default": "contain",
      "label": "Media Fit"
    },
    {
      "type": "checkbox",
      "id": "constrain_to_viewport",
      "default": true,
      "label": "Constrain to Viewport"
    },
    {
      "type": "select",
      "id": "image_zoom",
      "options": [
        {
          "value": "lightbox",
          "label": "Lightbox"
        },
        {
          "value": "hover",
          "label": "Hover"
        },
        {
          "value": "none",
          "label": "None"
        }
      ],
      "default": "none",
      "label": "Image Zoom",
      "info": "Set to 'None' to disable zoom"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "rating_text",
      "label": "Rating Text",
      "default": "Tested by 84 beta testers"
    },
    {
      "type": "text",
      "id": "headline",
      "label": "Headline",
      "default": "Ready to Feel the Shift?"
    },
    {
      "type": "text",
      "id": "tagline",
      "label": "Tagline",
      "default": "Fuel your brain. Skip the crash. Find your flow."
    },
    {
      "type": "header",
      "content": "Buy Options"
    },
    {
      "type": "text",
      "id": "bundle_option_title",
      "label": "Bundle Option Title",
      "default": "Buy 2, Get 1 Free"
    },
    {
      "type": "text",
      "id": "bundle_price",
      "label": "Bundle Price",
      "default": "$78"
    },
    {
      "type": "text",
      "id": "bundle_price_original",
      "label": "Bundle Original Price (Strikethrough)",
      "default": "$117"
    },
    {
      "type": "text",
      "id": "single_option_title",
      "label": "Single Option Title",
      "default": "Buy One Time"
    },
    {
      "type": "text",
      "id": "single_price",
      "label": "Single Price",
      "default": "$39"
    },
    {
      "type": "header",
      "content": "Call to Action"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "CTA Button Text",
      "default": "Add to Cart"
    },
    {
      "type": "text",
      "id": "free_shipping_text",
      "label": "Free Shipping Text",
      "default": "Free shipping"
    },
    {
      "type": "header",
      "content": "Tabs"
    },
    {
      "type": "text",
      "id": "tab_details_label",
      "label": "Details Tab Label",
      "default": "Details"
    },
    {
      "type": "richtext",
      "id": "tab_details_content",
      "label": "Details Tab Content",
      "default": "<p>Each serving delivers 2000mg of fruiting body mushrooms, 850mg of natural nootropics, 200mg of L-theanine, and 60mg of clean caffeine from green tea. Designed for sustained energy and all-day flow, Day Shrooms is vegan, non-GMO, gluten-free, and free of sugar alcohols. With a hint of sweet from maple and monk fruit, it's a clean, satisfying boost to fuel your day.</p>"
    },
    {
      "type": "text",
      "id": "tab_ingredients_label",
      "label": "Ingredients Tab Label",
      "default": "Ingredients"
    },
    {
      "type": "richtext",
      "id": "tab_ingredients_content",
      "label": "Ingredients Tab Content"
    },
    {
      "type": "text",
      "id": "tab_easy_to_make_label",
      "label": "Easy to Make Tab Label",
      "default": "Easy to Make"
    },
    {
      "type": "richtext",
      "id": "tab_easy_to_make_content",
      "label": "Easy to Make Tab Content"
    },
    {
      "type": "text",
      "id": "tab_guarantee_label",
      "label": "Guarantee Tab Label",
      "default": "Guarantee"
    },
    {
      "type": "richtext",
      "id": "tab_guarantee_content",
      "label": "Guarantee Tab Content"
    }
  ],
  "blocks": [
    {
      "type": "bundle_benefit",
      "name": "Bundle Benefit",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Benefit Text",
          "default": "60 Servings"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "DS LP Product Buy Box",
      "blocks": [
        {
          "type": "bundle_benefit",
          "settings": {
            "text": "60 Servings"
          }
        },
        {
          "type": "bundle_benefit",
          "settings": {
            "text": "$1.30/day"
          }
        },
        {
          "type": "bundle_benefit",
          "settings": {
            "text": "Free Shipping"
          }
        },
        {
          "type": "bundle_benefit",
          "settings": {
            "text": "Save $39"
          }
        },
        {
          "type": "bundle_benefit",
          "settings": {
            "text": "$1.30/day"
          }
        }
      ]
    }
  ]
}
{% endschema %}

